<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Flappy Bird</title>
<style>
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
  -webkit-tap-highlight-color: transparent;
}

body {
  width: 100vw;
  height: 100vh;
  overflow: hidden;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  font-family: 'Arial', sans-serif;
  display: flex;
  flex-direction: column;
  touch-action: none;
}

#gameContainer {
  flex: 1;
  display: flex;
  flex-direction: column;
  position: relative;
  max-width: 100%;
  max-height: 100%;
}

#gameCanvas {
  width: 100%;
  height: 100%;
  display: block;
  background: linear-gradient(180deg, #4ec0ca 0%, #87ceeb 100%);
}

#ui {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  padding: 10px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  pointer-events: none;
  z-index: 10;
}

#score {
  font-size: 24px;
  font-weight: bold;
  color: white;
  text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
}

#controls {
  display: flex;
  gap: 8px;
  pointer-events: all;
}

.btn {
  padding: 8px 12px;
  border: none;
  border-radius: 8px;
  background: rgba(255,255,255,0.9);
  color: #667eea;
  font-weight: bold;
  font-size: 12px;
  cursor: pointer;
  box-shadow: 0 2px 8px rgba(0,0,0,0.2);
  transition: all 0.2s;
}

.btn:active {
  transform: scale(0.95);
  box-shadow: 0 1px 4px rgba(0,0,0,0.2);
}

#gameOver {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  background: white;
  padding: 20px 30px;
  border-radius: 16px;
  text-align: center;
  box-shadow: 0 8px 32px rgba(0,0,0,0.3);
  display: none;
  z-index: 20;
}

#gameOver h2 {
  color: #667eea;
  margin-bottom: 10px;
  font-size: 28px;
}

#gameOver p {
  color: #666;
  margin-bottom: 15px;
  font-size: 16px;
}

#gameOver .btn {
  padding: 12px 24px;
  font-size: 16px;
  width: 100%;
  margin-top: 10px;
}

#instructions {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  background: white;
  padding: 20px;
  border-radius: 16px;
  box-shadow: 0 8px 32px rgba(0,0,0,0.3);
  max-width: 90%;
  z-index: 30;
  display: none;
}

#instructions h2 {
  color: #667eea;
  margin-bottom: 15px;
  font-size: 22px;
}

#instructions p {
  color: #666;
  margin-bottom: 10px;
  line-height: 1.6;
  font-size: 14px;
}

#instructions .btn {
  width: 100%;
  padding: 12px;
  font-size: 16px;
  margin-top: 15px;
}

#startScreen {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0,0,0,0.7);
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  z-index: 25;
}

#startScreen h1 {
  color: white;
  font-size: 36px;
  margin-bottom: 20px;
  text-shadow: 3px 3px 6px rgba(0,0,0,0.5);
}

#startScreen .btn {
  padding: 15px 40px;
  font-size: 18px;
  margin: 5px;
}

.hint {
  position: absolute;
  bottom: 20px;
  left: 50%;
  transform: translateX(-50%);
  color: white;
  font-size: 14px;
  text-align: center;
  text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
  pointer-events: none;
  z-index: 15;
}
</style>
</head>
<body>
<div id="gameContainer">
  <canvas id="gameCanvas"></canvas>
  
  <div id="ui">
    <div id="score">Score: 0</div>
    <div id="controls">
      <button class="btn" onclick="showInstructions()">?</button>
      <button class="btn" onclick="resetGame()">New</button>
    </div>
  </div>
  
  <div id="startScreen">
    <h1>üê¶ Flappy Bird</h1>
    <button class="btn" onclick="startGame()">Start Game</button>
    <button class="btn" onclick="showInstructions()">Instructions</button>
  </div>
  
  <div id="gameOver">
    <h2>Game Over!</h2>
    <p id="finalScore">Score: 0</p>
    <p id="highScore">Best: 0</p>
    <button class="btn" onclick="resetGame()">Play Again</button>
  </div>
  
  <div id="instructions">
    <h2>How to Play</h2>
    <p>üê¶ <strong>Tap or Click</strong> to make the bird flap and fly upward</p>
    <p>üö´ <strong>Avoid</strong> hitting the pipes or the ground</p>
    <p>‚≠ê <strong>Score points</strong> by passing through pipes</p>
    <p>üí° <strong>Tip:</strong> Time your taps carefully - the bird falls fast!</p>
    <button class="btn" onclick="closeInstructions()">Got It!</button>
  </div>
  
  <div class="hint" id="hint">Tap or Click to Flap!</div>
</div>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
const scoreEl = document.getElementById('score');
const gameOverEl = document.getElementById('gameOver');
const instructionsEl = document.getElementById('instructions');
const startScreenEl = document.getElementById('startScreen');
const hintEl = document.getElementById('hint');

let W, H;
let bird, pipes, score, highScore, gameActive, gameStarted;
let animationId;
let lastTime = 0;
let deltaTime = 0;

// Audio context for sounds
const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

function playSound(type) {
  const osc = audioCtx.createOscillator();
  const gain = audioCtx.createGain();
  
  osc.connect(gain);
  gain.connect(audioCtx.destination);
  
  if (type === 'flap') {
    osc.frequency.value = 300;
    gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
    gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.1);
    osc.start(audioCtx.currentTime);
    osc.stop(audioCtx.currentTime + 0.1);
  } else if (type === 'score') {
    osc.frequency.value = 500;
    gain.gain.setValueAtTime(0.15, audioCtx.currentTime);
    gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.15);
    osc.start(audioCtx.currentTime);
    osc.stop(audioCtx.currentTime + 0.15);
  } else if (type === 'hit') {
    osc.type = 'sawtooth';
    osc.frequency.value = 100;
    gain.gain.setValueAtTime(0.2, audioCtx.currentTime);
    gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.3);
    osc.start(audioCtx.currentTime);
    osc.stop(audioCtx.currentTime + 0.3);
  }
}

function resizeCanvas() {
  W = window.innerWidth;
  H = window.innerHeight;
  canvas.width = W;
  canvas.height = H;
}

function init() {
  resizeCanvas();
  highScore = localStorage.getItem('flappyHighScore') || 0;
  gameActive = false;
  gameStarted = false;
  resetGame();
}

function resetGame() {
  score = 0;
  gameActive = true;
  gameStarted = false;
  scoreEl.textContent = 'Score: 0';
  gameOverEl.style.display = 'none';
  startScreenEl.style.display = 'none';
  hintEl.style.display = 'block';
  
  bird = {
    x: W * 0.2,
    y: H / 2,
    velocity: 0,
    gravity: 0.4,
    jump: -7,
    radius: Math.min(W, H) * 0.04,
    maxVelocity: 10
  };
  
  pipes = [];
  createPipe();
  
  if (animationId) cancelAnimationFrame(animationId);
  gameLoop();
}

function startGame() {
  startScreenEl.style.display = 'none';
  resetGame();
}

function createPipe() {
  const gap = Math.min(H * 0.35, 200);
  const minHeight = H * 0.15;
  const maxHeight = H - gap - minHeight;
  const height = Math.random() * (maxHeight - minHeight) + minHeight;
  
  pipes.push({
    x: W,
    top: height,
    bottom: height + gap,
    width: Math.min(W * 0.15, 60),
    passed: false
  });
}

function flap() {
  if (!gameActive) return;
  
  if (!gameStarted) {
    gameStarted = true;
    hintEl.style.display = 'none';
  }
  
  bird.velocity = bird.jump;
  playSound('flap');
}

function update() {
  if (!gameActive || !gameStarted) return;
  
  // Normalize to 60fps - deltaTime is the multiplier for frame-independent movement
  const dtMultiplier = deltaTime / (1000 / 60);
  
  // Update bird with deltaTime compensation
  bird.velocity += bird.gravity * dtMultiplier;
  
  // Cap velocity to prevent too fast falling
  if (bird.velocity > bird.maxVelocity) {
    bird.velocity = bird.maxVelocity;
  }
  if (bird.velocity < -bird.maxVelocity) {
    bird.velocity = -bird.maxVelocity;
  }
  
  bird.y += bird.velocity * dtMultiplier;
  
  // Update pipes with deltaTime compensation
  const pipeSpeed = 2.5 * dtMultiplier;
  
  pipes.forEach((pipe, i) => {
    pipe.x -= pipeSpeed;
    
    // Score
    if (!pipe.passed && pipe.x + pipe.width < bird.x) {
      pipe.passed = true;
      score++;
      scoreEl.textContent = 'Score: ' + score;
      playSound('score');
      
      if (score > highScore) {
        highScore = score;
        localStorage.setItem('flappyHighScore', highScore);
      }
    }
    
    // Remove off-screen pipes
    if (pipe.x + pipe.width < 0) {
      pipes.splice(i, 1);
    }
  });
  
  // Create new pipes
  if (pipes.length === 0 || pipes[pipes.length - 1].x < W - W * 0.5) {
    createPipe();
  }
  
  // Check collisions
  checkCollisions();
}

function checkCollisions() {
  // Ground and ceiling
  if (bird.y + bird.radius > H || bird.y - bird.radius < 0) {
    endGame();
    return;
  }
  
  // Pipes
  pipes.forEach(pipe => {
    if (bird.x + bird.radius > pipe.x && bird.x - bird.radius < pipe.x + pipe.width) {
      if (bird.y - bird.radius < pipe.top || bird.y + bird.radius > pipe.bottom) {
        endGame();
      }
    }
  });
}

function endGame() {
  gameActive = false;
  playSound('hit');
  document.getElementById('finalScore').textContent = 'Score: ' + score;
  document.getElementById('highScore').textContent = 'Best: ' + highScore;
  gameOverEl.style.display = 'block';
}

function draw() {
  // Clear canvas
  ctx.fillStyle = '#87ceeb';
  ctx.fillRect(0, 0, W, H);
  
  // Draw clouds
  ctx.fillStyle = 'rgba(255,255,255,0.5)';
  for (let i = 0; i < 3; i++) {
    const cloudX = (W * (i / 3) + Date.now() * 0.01) % W;
    ctx.beginPath();
    ctx.arc(cloudX, H * 0.2 + i * 50, 30, 0, Math.PI * 2);
    ctx.arc(cloudX + 25, H * 0.2 + i * 50, 35, 0, Math.PI * 2);
    ctx.arc(cloudX + 50, H * 0.2 + i * 50, 30, 0, Math.PI * 2);
    ctx.fill();
  }
  
  // Draw pipes
  pipes.forEach(pipe => {
    ctx.fillStyle = '#4caf50';
    ctx.fillRect(pipe.x, 0, pipe.width, pipe.top);
    ctx.fillRect(pipe.x, pipe.bottom, pipe.width, H - pipe.bottom);
    
    // Pipe borders
    ctx.strokeStyle = '#2e7d32';
    ctx.lineWidth = 3;
    ctx.strokeRect(pipe.x, 0, pipe.width, pipe.top);
    ctx.strokeRect(pipe.x, pipe.bottom, pipe.width, H - pipe.bottom);
    
    // Pipe caps
    ctx.fillStyle = '#66bb6a';
    const capHeight = 25;
    ctx.fillRect(pipe.x - 5, pipe.top - capHeight, pipe.width + 10, capHeight);
    ctx.fillRect(pipe.x - 5, pipe.bottom, pipe.width + 10, capHeight);
  });
  
  // Draw bird
  ctx.save();
  ctx.translate(bird.x, bird.y);
  const angle = Math.min(Math.max(bird.velocity * 0.05, -0.5), 0.5);
  ctx.rotate(angle);
  
  // Bird body
  ctx.fillStyle = '#ffd700';
  ctx.beginPath();
  ctx.arc(0, 0, bird.radius, 0, Math.PI * 2);
  ctx.fill();
  
  // Bird eye
  ctx.fillStyle = 'white';
  ctx.beginPath();
  ctx.arc(bird.radius * 0.3, -bird.radius * 0.3, bird.radius * 0.3, 0, Math.PI * 2);
  ctx.fill();
  ctx.fillStyle = 'black';
  ctx.beginPath();
  ctx.arc(bird.radius * 0.4, -bird.radius * 0.3, bird.radius * 0.15, 0, Math.PI * 2);
  ctx.fill();
  
  // Bird beak
  ctx.fillStyle = '#ff6b6b';
  ctx.beginPath();
  ctx.moveTo(bird.radius, 0);
  ctx.lineTo(bird.radius * 1.5, bird.radius * 0.2);
  ctx.lineTo(bird.radius * 1.5, -bird.radius * 0.2);
  ctx.closePath();
  ctx.fill();
  
  ctx.restore();
  
  // Ground
  ctx.fillStyle = '#8B4513';
  ctx.fillRect(0, H - 20, W, 20);
  ctx.fillStyle = '#654321';
  for (let i = 0; i < W; i += 40) {
    ctx.fillRect(i, H - 20, 20, 20);
  }
}

function gameLoop(currentTime) {
  // Calculate delta time for frame-independent animation
  if (lastTime === 0) {
    lastTime = currentTime;
  }
  deltaTime = currentTime - lastTime;
  lastTime = currentTime;
  
  // Cap deltaTime to prevent huge jumps (e.g., when tab loses focus)
  if (deltaTime > 100) {
    deltaTime = 16.67; // ~60fps
  }
  
  update();
  draw();
  animationId = requestAnimationFrame(gameLoop);
}

function showInstructions() {
  instructionsEl.style.display = 'block';
}

function closeInstructions() {
  instructionsEl.style.display = 'none';
}

// Event listeners
canvas.addEventListener('click', flap);
canvas.addEventListener('touchstart', (e) => {
  e.preventDefault();
  flap();
}, { passive: false });

document.addEventListener('touchmove', (e) => {
  e.preventDefault();
}, { passive: false });

window.addEventListener('resize', resizeCanvas);
window.addEventListener('keydown', (e) => {
  if (e.code === 'Space') {
    e.preventDefault();
    flap();
  }
});

// Initialize
init();
</script>
</body>
</html>